#!/usr/bin/env python


def get_args():
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument('--infile', required=True)
    parser.add_argument('--outfile', required=True)

    parser.add_argument('--dtlow', type=float, default=-2)
    parser.add_argument('--dthigh', type=float, default=2)
    parser.add_argument('--tbinsize', type=float, default=0.02)
    return parser.parse_args()


def main():
    from xtcorr.util import load_sim, save_corr, pack_corr_results
    from xtcorr.constants import PAIRS
    from xtcorr.correlate import correlate

    args = get_args()
    indata, meta = load_sim(args.infile)

    pair_results = {}
    for pair in PAIRS:
        key = pair[0] + pair[1]

        dt, hist = correlate(
            data1=indata[pair[0]],
            data2=indata[pair[1]],

            dtlow=args.dtlow,
            dthigh=args.dthigh,
            tbinsize=args.tbinsize,
        )
        pair_results[key] = pack_corr_results(dt, hist)

    save_corr(outfile=args.outfile, pair_results=pair_results)


if __name__ == '__main__':
    main()
