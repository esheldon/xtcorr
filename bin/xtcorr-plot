#!/usr/bin/env python


def get_args():
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument('--infile', required=True)
    parser.add_argument('--outfile', required=True)
    return parser.parse_args()


def doplot(data, outfile):
    import matplotlib.pyplot as mplt
    import numpy as np

    fig, axs = mplt.subplots(ncols=2, figsize=(14, 6))
    axs[0].set(
        xlabel='delay [ns]',
        ylabel='count',
    )
    axs[1].set(
        xlabel='dx',
        ylabel='dy',
    )

    thist = data['hist'].sum(axis=(0, 1))
    terr = np.sqrt(thist)
    axs[0].errorbar(data['dt'], thist, terr, linestyle='')

    yxhist = data['hist'].sum(axis=2)
    # w, = np.where(
    #     (data['dt'] > 0.6) & (data['dt'] < 1.4)
    # )
    # yxhist = data['hist'][:, :, w].sum(axis=2)
    axs[1].imshow(yxhist)

    print('writing:', outfile)
    mplt.savefig(outfile)


def main():
    from xtcorr.util import load_corr

    args = get_args()

    data = load_corr(args.infile)

    doplot(data=data, outfile=args.outfile)


if __name__ == '__main__':
    main()
